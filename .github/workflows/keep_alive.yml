name: Health Check & Keep Render Alive

on:
    schedule:
        # Ping the API every 10 minutes to prevent Render from sleeping
        - cron: "*/10 * * * *"
    workflow_dispatch:

jobs:
    health-check:
        runs-on: ubuntu-latest
        timeout-minutes: 3 # Increased to allow API wake-up time

        steps:
            - name: Wake Up API (with retry)
              run: |
                  echo "üîî Waking up Render API..."
                  for i in {1..3}; do
                    echo "Attempt $i/3..."
                    STATUS=$(curl -s -o /dev/null -w "%{http_code}" --max-time 90 ${{ secrets.API_BASE_URL }}/health || echo "000")
                    if [ "$STATUS" = "200" ]; then
                      echo "‚úÖ API is awake! Status: $STATUS"
                      exit 0
                    else
                      echo "‚è≥ API is waking up... (Status: $STATUS)"
                      sleep 10
                    fi
                  done
                  echo "‚ö†Ô∏è API did not respond after 3 attempts"

            - name: Ping Model Status
              run: |
                  curl -s --max-time 60 ${{ secrets.API_BASE_URL }}/models/status | head -c 200 || echo "‚ö†Ô∏è Model status check failed"
